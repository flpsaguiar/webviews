/* eslint-disable */
(function() {

	'use strict';

	angular
		.module('stocksApp', [

			/* Vendors Modules
			============================================================================= */
			'ui.router',

			/* General Modules
			============================================================================= */
			'stocksApp.search',
			'stocksApp.stock',

		]);
})();

(function () { 
 return angular.module("stocksApp")
.constant("CONFIG", {
  "API": "https://webviews-test.herokuapp.com"
});

})();

/* eslint-disable */
(function(){

	angular.module('stocksApp.directives', [

	]);

})();

/* eslint-disable */
(function() {

	'use strict';

	angular
		.module('stocksApp.search', []);
})();

/* eslint-disable */
(function() {

	'use strict';

	angular
		.module('stocksApp.stock', []);
})();

/* eslint-disable */
(function() {

	'use strict';

	angular
		.module('stocksApp')
		.config(_configHttpProvider);

	function _configHttpProvider() {

	}

})();

/* eslint-disable */
(function() {

	'use strict';

	angular
		.module('stocksApp')
		.config(routes);

	routes.$inject = [
		'$stateProvider',
		'$urlRouterProvider',
	];

	function routes($stateProvider, $urlRouterProvider) {

		///////////// Redirects and Otherwise
		$urlRouterProvider
			.otherwise('/');

		///////////// State Configurations
		$stateProvider

		/* ==========================================================================
		= Index
		============================================================================= */
			.state('stock', {
				url: '/:id',
				templateUrl: 'templates/stock.html',
				controller: 'StockController as vm'
			})

			.state('search', {
				url: '/',
				templateUrl: 'templates/search.html',
				controller: 'SearchController as vm'
			});
	}
})();

/* eslint-disable */
(function(){

	angular
		.module('stocksApp')
		.controller('MainController', MainController);

	MainController.$inject = [
		'MainService',
		'$rootScope',
		'$window',
		'$state',
		'$timeout'
	];

	function MainController(MainService, $rootScope, $window, $state, $timeout) {
		var vm = this;

		console.log('init MainController >>>>');

		///////////// Public Properties
		$rootScope.$state = $state;

		///////////// Private Properties

		///////////// Public Methods

		///////////// Private Methods

		///////////// Events

		///////////// Bootstrap
		_init();

		///////////// Function Declarations
		function _init() {

		}

	}

})();

/* eslint-disable */
(function(){

	angular
		.module('stocksApp')
		.service('MainService', MainService);

	MainService.$inject = [
		'$http',
		'CONFIG'
	];

	function MainService($http, CONFIG) {
		var self = this;

		console.log('init MainService >>>>');

		///////////// Public Properties

		///////////// Private Properties

		///////////// Public Methods
		self.formatPrice = formatPrice;

		///////////// Private Methods

		///////////// Events

		///////////// Bootstrap

		///////////// Function Declarations
		function formatPrice(price) {
			if(price) {
				var _formatedPrice = "";
				_formatedPrice     = price.toFixed(2).replace('.', ',');

				var _tempArr          = _formatedPrice.split(',');
				var _dotsCount        = Math.ceil( _tempArr[0].length / 3 ) - 1;
				var _positionIncrease = 0;

				if(_dotsCount > 0) {
				var _reversedArr = _tempArr[0].split('').reverse();

				for(var i = 1; i <= _dotsCount; i++) {
					_reversedArr.splice(  (i * 3 + _positionIncrease)  , 0, '.');
					_positionIncrease++;
				}

				_tempArr[0] = _reversedArr.reverse().join('');
				_formatedPrice = _tempArr.join(',');
				}

				return _formatedPrice;
			} else {
				return '0,00';
			}
		}
	}

})();

/* eslint-disable */
(function(){

	angular
		.module('stocksApp.search')
		.controller('SearchController', SearchController);

	SearchController.$inject = [
		'$state'
	];

	function SearchController($state) {
		var vm = this;

		console.log('init SearchController >>>>');

		///////////// Public Properties

		///////////// Private Properties

		///////////// Public Methods
		vm.search = _search;

		///////////// Private Methods

		///////////// Events

		///////////// Bootstrap
		_init();

		///////////// Function Declarations
		function _init() {

		}

		function _search(e) {
			$state.go('stock', { id: vm.stockCode || 'PETR4' })
		}
	}

})();

/* eslint-disable */
(function(){

	angular
		.module('stocksApp.search')
		.service('SearchService', SearchService);

	SearchService.$inject = [
		'$http',
		'CONFIG'
	];

	function SearchService($http, CONFIG) {
		var self = this;

		console.log('init SearchService >>>>');

		///////////// Public Properties

		///////////// Private Properties

		///////////// Public Methods

		///////////// Private Methods

		///////////// Events

		///////////// Bootstrap

		///////////// Function Declarations

	}

})();

/* eslint-disable */
(function(){

	angular
		.module('stocksApp.stock')
		.controller('StockController', StockController);

	StockController.$inject = [
		'StockService',
		'$state'
	];

	function StockController(StockService, $state) {
		var vm = this;

		console.log('init StockController >>>>');

		///////////// Public Properties
		vm.stockData = null;

		///////////// Private Properties

		///////////// Public Methods

		///////////// Private Methods

		///////////// Events

		///////////// Bootstrap
		_init();

		///////////// Function Declarations
		function _init() {
			_getStockData();
		}

		function _getStockData() {
			console.log('getStockData', $state.params.id);
			StockService
				.getStockData($state.params.id)
				.then(function() {
					console.log('THEN');
					if(StockService.stockData) {
						vm.stockData = StockService.stockData;

						console.log(vm.stockData);
					}
				});
		}


	}

})();

/* eslint-disable */
(function(){

	angular
		.module('stocksApp.stock')
		.service('StockService', StockService);

	StockService.$inject = [
		'$http',
		'CONFIG',
		'MainService'
	];

	function StockService($http, CONFIG, MainService) {
		var self = this;

		console.log('init StockService >>>>');

		///////////// Public Properties

		///////////// Private Properties

		///////////// Public Methods
		self.getStockData = _getStockData;

		///////////// Private Methods

		///////////// Events

		///////////// Bootstrap

		///////////// Function Declarations
		function _getStockData(stockCode) {
			return $http
				.get(CONFIG.API + '/acoes/' + stockCode)
				.then(function(payload) {
					self.stockData = {
						name: payload.data.name,
						ticket: payload.data.ticket,
						abertura: {
							presentation: MainService.formatPrice(payload.data.abertura),
							value: payload.data.abertura
						},
						ano: {
							presentation: MainService.formatPrice(payload.data.ano),
							value: payload.data.ano
						},
						dia: {
							presentation: MainService.formatPrice(payload.data.dia),
							value: payload.data.dia
						},
						fechamento: {
							presentation: MainService.formatPrice(payload.data.fechamento),
							value: payload.data.fechamento
						},
						max: {
							presentation: MainService.formatPrice(payload.data.max),
							value: payload.data.max
						},
						mes: {
							presentation: MainService.formatPrice(payload.data.mes),
							value: payload.data.mes
						},
						min: {
							presentation: MainService.formatPrice(payload.data.min),
							value: payload.data.min
						},
						preco: {
							presentation: MainService.formatPrice(payload.data.preco),
							value: payload.data.preco
						},
						semana: {
							presentation: MainService.formatPrice(payload.data.semana),
							value: payload.data.semana
						},
					};
				});
		}

	}

})();
